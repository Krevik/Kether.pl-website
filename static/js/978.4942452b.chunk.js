"use strict";(globalThis.webpackChunkkether_pl=globalThis.webpackChunkkether_pl||[]).push([[978],{978:(e,t,s)=>{s.r(t),s.d(t,{default:()=>M});var n=s(3678),a=s(3532),o=s(6811),i=s(6397),r=s(5569),c=s(2755),d=s(3375),l=s(9580),m=s(7514),p=s(9299);const u={maxAttempts:3,initialDelay:1e3,maxDelay:1e4,backoffMultiplier:2,retryCondition:m.$d};async function h(e,t={},s){const n={...u,...t};let a,o=n.initialDelay;for(let r=1;r<=n.maxAttempts;r++)try{return{success:!0,data:await e(),attempts:r}}catch(i){const e=(0,m.KR)(i,m.By.UNKNOWN,m.MU.MEDIUM,{...s,attempt:r});a=e,p.A.logErrorWithRetry(i,{...s,attempt:r},r-1);if(!(r<n.maxAttempts&&(!n.retryCondition||n.retryCondition(e))))break;n.onRetry&&n.onRetry(r,e),r<n.maxAttempts&&(await g(o),o=Math.min(o*n.backoffMultiplier,n.maxDelay))}return{success:!1,error:a,attempts:n.maxAttempts}}function g(e){return new Promise(t=>setTimeout(t,e))}const C=()=>{const e=(0,a.d4)(e=>e.serverInfoReducer.serverInfo),t=(0,o.useRef)(!1);(0,o.useEffect)(()=>{e||t.current||f(e,t);const s=setInterval(()=>{t.current||f(e,t)},l.i3.REFRESH_INTERVAL_MS);return()=>{clearInterval(s)}},[e])},f=async(e,t)=>{t.current=!0;const s=await h(async()=>{const e=new AbortController,t=setTimeout(()=>e.abort(),l.i3.DEFAULT_TIMEOUT_MS);try{const s=await fetch(i.Y.SERVER_INFO,{signal:e.signal});if(clearTimeout(t),!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const n=await s.json(),a=JSON.stringify(n);if(a.includes("GDError")||a.includes("Couldn't query"))throw new Error("Game server query timeout - backend could not reach game server");return n}catch(s){throw clearTimeout(t),s}},{maxAttempts:3,initialDelay:2e3,retryCondition:e=>{var t;return e.type===m.By.NETWORK||e.type===m.By.SERVER&&500!==e.code||(null===(t=e.message)||void 0===t?void 0:t.includes("query timeout"))}},{component:"ServerInfoService",action:"fetch_server_info"});try{if(s.success&&s.data){const e=s.data;e.status=Object.keys(e).length>0?"1":"0",r.j.dispatch(c.n.setServerInfo(e))}else if(s.error){var n;p.A.logError(s.error,{component:"ServerInfoService",action:"fetch_server_info",attempts:s.attempts},s.error.type,s.error.severity);if(null===(n=s.error.message)||void 0===n?void 0:n.includes("query timeout")){if(console.warn("Game server query timeout - retaining last known data"),!e){const e={name:"Kether.pl",map:"\u2013",players:"0",maxplayers:"0",bots:0,playerdetails:[],status:"0"};r.j.dispatch(c.n.setServerInfo(e))}}else{const e=(0,m.Qk)(s.error);d.t.ERROR(e);const t={name:"Kether.pl",map:"\u2013",players:"0",maxplayers:"0",bots:0,playerdetails:[],status:"0"};r.j.dispatch(c.n.setServerInfo(t))}}}finally{t.current=!1}};var b=s(4177),x=s(9638),y=s(2637),j=s(8663),v=s(7963);const R=(0,y.sC)(function(){const e=(0,a.d4)(e=>e.serverInfoReducer.serverInfo),t=(0,j.fE)();C();const s=(0,o.useCallback)(e=>{const t=~~(e/3600),s=~~(e%3600/60),n=~~e%60;let a="";return t>0&&(a+=t+":"+(s<10?"0":"")),a+=s+":"+(n<10?"0":""),a+=""+n,a},[]),i=(0,o.useCallback)(e=>(0,v.jsx)("span",{children:s(e.duration)}),[s]),r=(0,o.useCallback)(()=>{var s;return null!==e&&void 0!==e&&null!==(s=e.playerdetails)&&void 0!==s&&s.length?(0,v.jsx)("div",{className:"player-list-table",children:(0,v.jsxs)(b.b,{value:e.playerdetails,removableSort:!0,sortMode:"multiple",scrollable:!0,emptyMessage:t.noPlayersAvailable,children:[(0,v.jsx)(x.V,{field:"name",header:t.nickname,sortable:!0}),(0,v.jsx)(x.V,{field:"score",header:t.score,sortable:!0}),(0,v.jsx)(x.V,{body:i,header:t.duration})]})}):null},[e,i,t]);return(0,v.jsxs)("div",{className:"section future-rot",children:[(0,v.jsxs)("span",{children:[t.name,": ",null===e||void 0===e?void 0:e.name]}),(0,v.jsxs)("span",{children:["IP: ",l.Fq.IP,(0,v.jsx)(n.$,{icon:"pi pi-copy",style:{scale:"0.8",verticalAlign:"unset"},onClick:()=>{navigator.clipboard.writeText(l.Fq.IP),d.t.SUCCESS(l.PL.COPY_SUCCESS)}})]}),(0,v.jsxs)("span",{children:[t.players,": ",null===e||void 0===e?void 0:e.players,"/",null===e||void 0===e?void 0:e.maxplayers," (",null===e||void 0===e?void 0:e.bots," ",1===(null===e||void 0===e?void 0:e.bots)?t.bot:t.bots,")"]}),(0,v.jsxs)("span",{children:[t.status,": ","1"===(null===e||void 0===e?void 0:e.status)?t.online:t.offline]}),(0,v.jsxs)("span",{children:[t.map,": ",null===e||void 0===e?void 0:e.map]}),(0,v.jsx)("span",{children:(0,v.jsx)(n.$,{label:t.joinGame,onClick:()=>{window.location.href=l.Fq.STEAM_CONNECT_URL}})}),r()&&(0,v.jsx)("span",{children:r()}),(0,v.jsxs)("span",{className:"centered-text",children:[t.customMapsText,(0,v.jsx)("a",{style:{display:"inline-block",marginLeft:"10px",textDecoration:"none",color:"white",WebkitTextStroke:" 3px red"},href:"https://steamcommunity.com/sharedfiles/filedetails/?id=2542824628",children:t.here})]})]})});var D=s(3520);const S={useCommandsLoadingService:()=>{k()},getCommands:()=>fetch(`${i.Y.COMMANDS}/getCommands`,{method:"get"}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{r.j.dispatch(D.U.setCommands(e))}).catch(e=>{d.t.ERROR(`Error while fetching commands: ${e.message}`)}),addNewCommand:e=>fetch(`${i.Y.COMMANDS}/addCommand`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:e.command,description:e.description})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>(S.getCommands(),e)).catch(e=>{throw d.t.ERROR(`Error while adding new command: ${e.message}`),e}),deleteCommand:e=>fetch(`${i.Y.COMMANDS}/deleteCommand`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>(S.getCommands(),e.message)).catch(e=>{throw d.t.ERROR(`Error while deleting command: ${e.message}`),e}),updateCommand:e=>fetch(`${i.Y.COMMANDS}/updateCommand`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id,command:e.command,description:e.description})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>(S.getCommands(),e.message)).catch(e=>{throw d.t.ERROR(`Error while updating command: ${e.message}`),e})},k=()=>{(0,o.useEffect)(()=>{S.getCommands()},[])};var E=s(6915),N=s(4843);function w(e){return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("h5",{children:"Command"}),(0,v.jsx)(N.S,{value:e.command,onChange:t=>e.setCommand(t.target.value)}),(0,v.jsx)("h5",{children:"Description"}),(0,v.jsx)(N.S,{value:e.commandDescription,onChange:t=>e.setCommandDescription(t.target.value)})]})}function T(e){const t=(0,j.Sx)(),s=(0,j.FC)();return(0,v.jsx)(E.l,{visible:e.isDialogVisible,header:t.editCommand,modal:!0,className:"p-fluid",footer:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(n.$,{label:s.cancel,icon:"pi pi-times",className:"p-button-text",onClick:()=>{e.commandEditingIdRef.current=-1,e.setDialogVisibility(!1)}}),(0,v.jsx)(n.$,{label:s.update,icon:"pi pi-check",className:"p-button-text",onClick:()=>{const t={command:e.command,description:e.commandDescription,id:e.commandEditingIdRef.current};S.updateCommand(t).then(()=>{d.t.SUCCESS("Successfully updated the command"),e.setDialogVisibility(!1),e.commandEditingIdRef.current=-1}).catch(e=>{d.t.ERROR(`Couldn't update the command: ${e.message}`)})}})]}),onHide:()=>{e.setDialogVisibility(!1)},children:(0,v.jsx)(w,{command:e.command,commandDescription:e.commandDescription,setCommand:e.setCommand,setCommandDescription:e.setCommandDescription})})}var O=s(4400);function $(e){const t=(0,j.Sx)(),s=(0,j.FC)(),a=(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(n.$,{label:s.cancel,icon:"pi pi-times",className:"p-button-text",onClick:()=>e.setDialogVisibility(!1)}),(0,v.jsx)(n.$,{label:s.save,icon:"pi pi-check",className:"p-button-text",onClick:()=>{const s={command:e.command,description:e.commandDescription};S.addNewCommand(s).then(()=>{d.t.SUCCESS(t.successfullyAdded),e.setDialogVisibility(!1),e.setCommandDescription("")}).catch(e=>{d.t.ERROR(`${t.couldntAdd}: ${e.message}`)})}})]});return(0,v.jsx)(E.l,{visible:e.isDialogVisible,header:t.addNewCommand,modal:!0,className:"p-fluid",footer:a,onHide:()=>e.setDialogVisibility(!1),children:(0,v.jsx)(w,{setCommandDescription:e.setCommandDescription,commandDescription:e.commandDescription,setCommand:e.setCommand,command:e.command})})}function _(){const e=(0,a.d4)(e=>e.userDataReducer.isAdmin),t=(0,a.d4)(e=>e.commandsReducer.commands),s=(0,j.Sx)(),[i,r]=(0,o.useState)(""),c=(0,o.useRef)(-1),[l,m]=(0,o.useState)(""),[p,u]=(0,o.useState)(!1),[h,g]=(0,o.useState)(!1);S.useCommandsLoadingService();return(0,v.jsxs)("div",{className:"section",children:[(0,v.jsx)($,{setCommandDescription:r,commandDescription:i,setCommand:m,command:l,isDialogVisible:p,setDialogVisibility:u}),(0,v.jsx)(T,{setCommandDescription:r,commandDescription:i,setCommand:m,command:l,commandEditingIdRef:c,isDialogVisible:h,setDialogVisibility:g}),e&&(0,v.jsx)(O.M,{className:"mb-4",start:(0,v.jsx)(v.Fragment,{children:e&&(0,v.jsx)(n.$,{label:s.newCommand,icon:"pi pi-plus",className:"mr-2","data-toggle":"tooltip",title:s.addNewCommandTooltip,onClick:()=>u(!0)})})}),(0,v.jsxs)(b.b,{value:t,responsiveLayout:"scroll",style:{backgroundColor:"transparent",background:"transparent",backdropFilter:"blur(2px)"},emptyMessage:s.noCommandsAvailable,children:[(0,v.jsx)(x.V,{field:"command",header:s.command}),(0,v.jsx)(x.V,{field:"description",header:s.description}),e&&(0,v.jsx)(x.V,{header:s.actions,body:e=>(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(n.$,{"data-toggle":"tooltip",title:s.editCommandTooltip,icon:"pi pi-pencil",className:"p-button-rounded mr-2",onClick:()=>{c.current=e.id,g(!0),m(e.command),r(e.description)}}),(0,v.jsx)(n.$,{"data-toggle":"tooltip",title:s.deleteCommandTooltip,icon:"pi pi-trash",className:"p-button-rounded p-button-danger",onClick:()=>{S.deleteCommand(e).then(e=>{d.t.SUCCESS(`${e}`),u(!1),r("")}).catch(e=>{d.t.ERROR(`${s.couldntDelete}: ${e}`)})}})]})})]})]})}var A=s(4859),I=s(2847);function M(){return(0,v.jsx)(A.K,{imageUrl:I.Y.BACKGROUND_1,children:(0,v.jsxs)("div",{className:"home-page",children:[(0,v.jsx)(R,{}),(0,v.jsx)(_,{})]})})}},1382:(e,t,s)=>{e.exports=s.p+"static/media/background_3.4e932a7e40bb7c3fc904.jpg"},2847:(e,t,s)=>{s.d(t,{Y:()=>n});const n={BACKGROUND_1:s(2916),BACKGROUND_2:s(4547),BACKGROUND_3:s(1382),BACKGROUND_4:s(9197),BACKGROUND_5:s(3616),BACKGROUND_6:s(7231)}},2916:(e,t,s)=>{e.exports=s.p+"static/media/background_1.bbbbf33c0f3cf7222559.jpg"},3616:(e,t,s)=>{e.exports=s.p+"static/media/background_5.4d636ab7f678d71f2368.jpg"},4547:(e,t,s)=>{e.exports=s.p+"static/media/background_2.7713c83c2427f6bd817f.jpg"},4859:(e,t,s)=>{s.d(t,{K:()=>o});const n="PageWithBackground_pageWithBackground__nL8hr";s(6811);var a=s(7963);const o=e=>(0,a.jsx)("div",{className:n,style:{backgroundImage:`url(${e.imageUrl})`},children:e.children})},7231:(e,t,s)=>{e.exports=s.p+"static/media/background_6.941575f694ad75fbd537.jpg"},9197:(e,t,s)=>{e.exports=s.p+"static/media/background_4.afd7ff29b91152c81d22.jpg"}}]);