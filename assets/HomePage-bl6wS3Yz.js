import{i as e,c as t,E as s,a,e as n,A as o,b as r,s as i,g as m,n as l,d,w as c,u,j as p,S as h,f,h as C,k as g,l as x}from"./index-BlLq8fAh.js";import{b as y,d as b,B as j,I as v,e as R,f as D}from"./primereact-a-ERR-hv.js";import{u as E}from"./redux-vendor-H9NaJiP7.js";import{a as S}from"./react-vendor-Cx5UeZsH.js";import{P as w,B as N}from"./backgrounds-CjqIChQv.js";import"./i18n-DzW3M4iQ.js";const k={maxAttempts:3,initialDelay:1e3,maxDelay:1e4,backoffMultiplier:2,retryCondition:e};function T(e){return new Promise(t=>setTimeout(t,e))}const O=()=>{const e=E(e=>e.serverInfoReducer.serverInfo),t=S.useRef(!1);S.useEffect(()=>{e||t.current||$(e,t);const s=setInterval(()=>{t.current||$(e,t)},o.REFRESH_INTERVAL_MS);return()=>{clearInterval(s)}},[e])},$=async(e,c)=>{var u;c.current=!0;const p=await async function(e,o={},r){const i={...k,...o};let m,l=i.initialDelay;for(let c=1;c<=i.maxAttempts;c++)try{return{success:!0,data:await e(),attempts:c}}catch(d){const e=t(d,a.UNKNOWN,s.MEDIUM,{...r,attempt:c});if(m=e,n.logErrorWithRetry(d,{...r,attempt:c},c-1),!(c<i.maxAttempts)||i.retryCondition&&!i.retryCondition(e))break;i.onRetry&&i.onRetry(c,e),c<i.maxAttempts&&(await T(l),l=Math.min(l*i.backoffMultiplier,i.maxDelay))}return{success:!1,error:m,attempts:i.maxAttempts}}(async()=>{const e=new AbortController,t=setTimeout(()=>e.abort(),o.DEFAULT_TIMEOUT_MS);try{const s=await fetch(d.SERVER_INFO,{signal:e.signal});if(clearTimeout(t),!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json(),n=JSON.stringify(a);if(n.includes("GDError")||n.includes("Couldn't query"))throw new Error("Game server query timeout - backend could not reach game server");return a}catch(s){throw clearTimeout(t),s}},{maxAttempts:3,initialDelay:2e3,retryCondition:e=>{var t;return e.type===a.NETWORK||e.type===a.SERVER&&500!==e.code||(null==(t=e.message)?void 0:t.includes("query timeout"))}},{component:"ServerInfoService",action:"fetch_server_info"});try{if(p.success&&p.data){const e=p.data;e.status=Object.keys(e).length>0?"1":"0",r.dispatch(i.setServerInfo(e))}else if(p.error){n.logError(p.error,{component:"ServerInfoService",action:"fetch_server_info",attempts:p.attempts},p.error.type,p.error.severity);if(null==(u=p.error.message)?void 0:u.includes("query timeout")){if(!e){const e={name:"Kether.pl",map:"â€“",players:"0",maxplayers:"0",bots:0,playerdetails:[],status:"0"};r.dispatch(i.setServerInfo(e))}}else{const e=m(p.error);l.ERROR(e);const t={name:"Kether.pl",map:"â€“",players:"0",maxplayers:"0",bots:0,playerdetails:[],status:"0"};r.dispatch(i.setServerInfo(t))}}}finally{c.current=!1}};const I=c(function(){const e=E(e=>e.serverInfoReducer.serverInfo),t=u();O();const s=S.useCallback(e=>{const t=~~(e/3600),s=~~(e%3600/60),a=~~e%60;let n="";return t>0&&(n+=t+":"+(s<10?"0":"")),n+=s+":"+(a<10?"0":""),n+=""+a,n},[]),a=S.useCallback(e=>p.jsx("span",{children:s(e.duration)}),[s]),n=S.useCallback(()=>{var s;return(null==(s=null==e?void 0:e.playerdetails)?void 0:s.length)?p.jsx("div",{className:"player-list-table",children:p.jsxs(y,{value:e.playerdetails,removableSort:!0,sortMode:"multiple",scrollable:!0,emptyMessage:t.noPlayersAvailable,children:[p.jsx(b,{field:"name",header:t.nickname,sortable:!0}),p.jsx(b,{field:"score",header:t.score,sortable:!0}),p.jsx(b,{body:a,header:t.duration})]})}):null},[e,a,t]);return p.jsxs("div",{className:"section future-rot",children:[p.jsxs("span",{children:[t.name,": ",null==e?void 0:e.name]}),p.jsxs("span",{children:["IP: ",h.IP,p.jsx(j,{label:"ðŸ“„",className:"large-emoji-button",style:{scale:"0.8",verticalAlign:"unset"},onClick:()=>{navigator.clipboard.writeText(h.IP),l.SUCCESS(f.COPY_SUCCESS)},children:p.jsx("span",{className:"large-copy-emoji",children:"ðŸ“„"})})]}),p.jsxs("span",{children:[t.players,": ",null==e?void 0:e.players,"/",null==e?void 0:e.maxplayers," (",null==e?void 0:e.bots," ",1===(null==e?void 0:e.bots)?t.bot:t.bots,")"]}),p.jsxs("span",{children:[t.status,": ","1"===(null==e?void 0:e.status)?t.online:t.offline]}),p.jsxs("span",{children:[t.map,": ",null==e?void 0:e.map]}),p.jsx("span",{children:p.jsx(j,{label:t.joinGame,onClick:()=>{window.location.href=h.STEAM_CONNECT_URL}})}),n()&&p.jsx("span",{children:n()}),p.jsxs("span",{className:"centered-text",children:[t.customMapsText,p.jsx("a",{style:{display:"inline-block",marginLeft:"10px",textDecoration:"none",color:"white",WebkitTextStroke:" 3px red"},href:"https://steamcommunity.com/sharedfiles/filedetails/?id=2542824628",children:t.here})]})]})}),A={useCommandsLoadingService:()=>{M()},getCommands:()=>fetch(`${d.COMMANDS}/getCommands`,{method:"get"}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{r.dispatch(C.setCommands(e))}).catch(e=>{l.ERROR(`Error while fetching commands: ${e.message}`)}),addNewCommand:e=>fetch(`${d.COMMANDS}/addCommand`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:e.command,description:e.description})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>(A.getCommands(),e)).catch(e=>{throw l.ERROR(`Error while adding new command: ${e.message}`),e}),deleteCommand:e=>fetch(`${d.COMMANDS}/deleteCommand`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>(A.getCommands(),e.message)).catch(e=>{throw l.ERROR(`Error while deleting command: ${e.message}`),e}),updateCommand:e=>fetch(`${d.COMMANDS}/updateCommand`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id,command:e.command,description:e.description})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>(A.getCommands(),e.message)).catch(e=>{throw l.ERROR(`Error while updating command: ${e.message}`),e})},M=()=>{S.useEffect(()=>{A.getCommands()},[])};function V(e){return p.jsxs(p.Fragment,{children:[p.jsx("h5",{children:"Command"}),p.jsx(v,{value:e.command,onChange:t=>e.setCommand(t.target.value)}),p.jsx("h5",{children:"Description"}),p.jsx(v,{value:e.commandDescription,onChange:t=>e.setCommandDescription(t.target.value)})]})}function _(e){const t=g(),s=x();return p.jsx(R,{visible:e.isDialogVisible,header:t.editCommand,modal:!0,className:"p-fluid",footer:p.jsxs(p.Fragment,{children:[p.jsx(j,{label:`âŒ ${s.cancel}`,className:"p-button-text",onClick:()=>{e.commandEditingIdRef.current=-1,e.setDialogVisibility(!1)}}),p.jsx(j,{label:`âœ… ${s.update}`,className:"p-button-text",onClick:()=>{const t={command:e.command,description:e.commandDescription,id:e.commandEditingIdRef.current};A.updateCommand(t).then(()=>{l.SUCCESS("Successfully updated the command"),e.setDialogVisibility(!1),e.commandEditingIdRef.current=-1}).catch(e=>{l.ERROR(`Couldn't update the command: ${e.message}`)})}})]}),onHide:()=>{e.setDialogVisibility(!1)},children:p.jsx(V,{command:e.command,commandDescription:e.commandDescription,setCommand:e.setCommand,setCommandDescription:e.setCommandDescription})})}function P(e){const t=g(),s=x(),a=p.jsxs(p.Fragment,{children:[p.jsx(j,{label:`âŒ ${s.cancel}`,className:"p-button-text",onClick:()=>e.setDialogVisibility(!1)}),p.jsx(j,{label:`âœ… ${s.save}`,className:"p-button-text",onClick:()=>{const s={command:e.command,description:e.commandDescription};A.addNewCommand(s).then(()=>{l.SUCCESS(t.successfullyAdded),e.setDialogVisibility(!1),e.setCommandDescription("")}).catch(e=>{l.ERROR(`${t.couldntAdd}: ${e.message}`)})}})]});return p.jsx(R,{visible:e.isDialogVisible,header:t.addNewCommand,modal:!0,className:"p-fluid",footer:a,onHide:()=>e.setDialogVisibility(!1),children:p.jsx(V,{setCommandDescription:e.setCommandDescription,commandDescription:e.commandDescription,setCommand:e.setCommand,command:e.command})})}function U(){const e=E(e=>e.userDataReducer.isAdmin),t=E(e=>e.commandsReducer.commands),s=g(),[a,n]=S.useState(""),o=S.useRef(-1),[r,i]=S.useState(""),[m,d]=S.useState(!1),[c,u]=S.useState(!1);A.useCommandsLoadingService();return p.jsxs("div",{className:"section",children:[p.jsx(P,{setCommandDescription:n,commandDescription:a,setCommand:i,command:r,isDialogVisible:m,setDialogVisibility:d}),p.jsx(_,{setCommandDescription:n,commandDescription:a,setCommand:i,command:r,commandEditingIdRef:o,isDialogVisible:c,setDialogVisibility:u}),e&&p.jsx(D,{className:"mb-4",start:p.jsx(p.Fragment,{children:e&&p.jsx(j,{label:`âž• ${s.newCommand}`,className:"mr-2","data-toggle":"tooltip",title:s.addNewCommandTooltip,onClick:()=>d(!0)})})}),p.jsxs(y,{value:t,responsiveLayout:"scroll",style:{backgroundColor:"transparent",background:"transparent",backdropFilter:"blur(2px)"},emptyMessage:s.noCommandsAvailable,children:[p.jsx(b,{field:"command",header:s.command}),p.jsx(b,{field:"description",header:s.description}),e&&p.jsx(b,{header:s.actions,body:e=>p.jsxs(p.Fragment,{children:[p.jsx(j,{"data-toggle":"tooltip",title:s.editCommandTooltip,label:"âœï¸",className:"p-button-rounded mr-2",onClick:()=>{o.current=e.id,u(!0),i(e.command),n(e.description)}}),p.jsx(j,{"data-toggle":"tooltip",title:s.deleteCommandTooltip,label:"ðŸ—‘ï¸",className:"p-button-rounded p-button-danger",onClick:()=>{A.deleteCommand(e).then(e=>{l.SUCCESS(`${e}`),d(!1),n("")}).catch(e=>{l.ERROR(`${s.couldntDelete}: ${e}`)})}})]})})]})]})}function F(){return p.jsx(w,{imageUrl:N.BACKGROUND_1,children:p.jsxs("div",{className:"home-page",children:[p.jsx(I,{}),p.jsx(U,{})]})})}export{F as default};
