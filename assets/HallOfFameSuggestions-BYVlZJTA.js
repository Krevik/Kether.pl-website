import{r as m,t as g,n as r,b as R,v as N,x,l as E,j as s,m as y}from"./index-B0VHPENL.js";import{e as $,B as S,f as w,b as _,d as h}from"./primereact-PWt0ZiM-.js";import{u as l}from"./redux-vendor-CJ8-OCLT.js";import{D as C,t as I,b as P}from"./DialogBindContent-BVdELKKi.js";import{a as c}from"./react-vendor-D_ZCUrOg.js";import{P as O,B as v}from"./backgrounds-BoYJZBYz.js";import"./i18n-5_3iJCmZ.js";const u={useBindSuggestionsLoadingService:()=>H(),getBindSuggestions:()=>fetch(`${m}${g.API_BASE_PATH}${g.BIND_SUGGESTIONS_PATH}/getBindSuggestions`,{method:"get"}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{R.dispatch(N.setBindSuggestions(e))}).catch(e=>{r.ERROR(`Error while fetching bind suggestions: ${e.message}`)}),addNewBindSuggestion:e=>fetch(`${m}${g.API_BASE_PATH}${g.BIND_SUGGESTIONS_PATH}/addBindSuggestion`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({author:e.author,text:e.text,proposed_by:e.proposed_by})}).then(t=>{if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return u.getBindSuggestions(),t.json()}).catch(t=>{throw r.ERROR(`Error while adding new bind suggestion: ${t.message}`),t}),deleteBindSuggestion:e=>fetch(`${m}${g.API_BASE_PATH}${g.BIND_SUGGESTIONS_PATH}/deleteBindSuggestion`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id})}).then(t=>{if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}).then(t=>(u.getBindSuggestions(),t.message)).catch(t=>{throw r.ERROR(`Error while deleting bind suggestion: ${t.message}`),t})},H=()=>{const e=l(n=>n.userDataReducer.userData),[t,i]=c.useState(!0);return c.useEffect(()=>{i(!0),u.getBindSuggestions().finally(()=>{i(!1)})},[e]),t};function k(e){const t=l(a=>a.userDataReducer.userData),i=x(),n=E(),o=s.jsxs(s.Fragment,{children:[s.jsx(S,{label:n.cancel,icon:"pi pi-times",className:"p-button-text",onClick:()=>e.setDialogVisibility(!1)}),s.jsx(S,{label:n.save,icon:"pi pi-check",className:"p-button-text",onClick:()=>{const a={id:-1,proposed_by:t.personaname,author:e.bindAuthor,text:e.bindText};u.addNewBindSuggestion(a).then(()=>{r.SUCCESS(i.successfullySuggested),e.setDialogVisibility(!1),e.setBindText("")}).catch(b=>{r.ERROR(`${i.couldntAdd}: ${b}`)})}})]});return s.jsx($,{visible:e.isDialogVisible,header:i.addNewSuggestion,modal:!0,className:"p-fluid",footer:o,onHide:()=>e.setDialogVisibility(!1),children:s.jsx(C,{setBindText:e.setBindText,bindText:e.bindText,setBindAuthor:e.setBindAuthor,bindAuthor:e.bindAuthor})})}const U=e=>e.map(t=>({...t,author:`${t.author} : `})),G=(e,t,i)=>s.jsx(s.Fragment,{children:e&&s.jsx(S,{label:i.suggestBind,icon:"pi pi-plus",className:"p-button-success mr-2","data-toggle":"tooltip",title:i.suggestBindTooltip,onClick:()=>t(!0)})}),L=(e,t,i,n)=>t&&s.jsxs(s.Fragment,{children:[s.jsx(S,{"data-toggle":"tooltip",title:n.acceptBindTooltip,icon:"pi pi-check",className:"p-button-rounded p-button-success",onClick:()=>{const o=I(e);P.addNewBind(o,i==null?void 0:i.steamid).then(a=>{r.SUCCESS(n.successfullyAccepted),u.deleteBindSuggestion(o)}).catch(a=>{r.ERROR(`${n.couldntAccept}: ${a}`)})}}),s.jsx(S,{"data-toggle":"tooltip",title:n.deleteSuggestionTooltip,icon:"pi pi-times",className:"p-button-rounded p-button-danger",onClick:()=>{u.deleteBindSuggestion(e).then(o=>{r.SUCCESS(`Successfully deleted bind suggestion: ${o}`)}).catch(o=>{r.ERROR(`${n.couldntDelete}: ${o}`)})}})]});function z(){const e=l(d=>d.bindSuggestionsReducer.bindSuggestions),t=x(),i=y(),n=l(d=>d.userDataReducer.userID),o=l(d=>d.userDataReducer.userData),a=l(d=>d.userDataReducer.isAdmin),[b,B]=c.useState(!1),[f,p]=c.useState(""),T=c.useRef(-1),[j,A]=c.useState(""),D=u.useBindSuggestionsLoadingService();return s.jsx(O,{imageUrl:v.BACKGROUND_2,children:s.jsx("div",{className:"hall-of-fame-suggestions",children:s.jsxs("div",{className:"card",children:[s.jsx(k,{setBindText:A,bindText:j,setBindAuthor:p,bindAuthor:f,bindEditingIdRef:T,isDialogVisible:b,setDialogVisibility:B}),s.jsx(w,{className:"mb-4",start:G(n,B,t)}),s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"centered-text",children:t.bindSuggestions}),s.jsx("div",{className:"card",children:D?s.jsx("p",{children:"Loading..."}):s.jsxs(_,{value:U(e),scrollable:!0,scrollHeight:"flex",emptyMessage:t.noSuggestionsAvailable,children:[a&&s.jsx(h,{field:"id",header:i.databaseId,sortable:!0}),s.jsx(h,{field:"proposed_by",header:t.proposedBy}),s.jsx(h,{field:"author",header:i.author,sortable:!0}),s.jsx(h,{field:"text",header:i.text,sortable:!0}),a&&s.jsx(h,{header:i.actions,body:d=>L(d,a,o,t)})]})})]})]})})})}export{z as default};
