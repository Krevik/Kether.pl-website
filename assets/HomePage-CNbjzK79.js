import{i as e,c as t,E as s,a,e as n,A as o,b as i,s as r,g as c,n as m,d,w as l,u as p,j as u,S as h,f,h as C,k as g,l as x}from"./index-B2TxqSS5.js";import{b as y,d as b,B as j,I as v,e as R,f as D}from"./primereact-a-ERR-hv.js";import{u as E}from"./redux-vendor-H9NaJiP7.js";import{a as S}from"./react-vendor-Cx5UeZsH.js";import{P as w,B as N}from"./backgrounds-CwabJ92T.js";import"./i18n-DzW3M4iQ.js";const k={maxAttempts:3,initialDelay:1e3,maxDelay:1e4,backoffMultiplier:2,retryCondition:e};function T(e){return new Promise(t=>setTimeout(t,e))}const O=()=>{const e=E(e=>e.serverInfoReducer.serverInfo),t=S.useRef(!1);S.useEffect(()=>{e||t.current||I(e,t);const s=setInterval(()=>{t.current||I(e,t)},o.REFRESH_INTERVAL_MS);return()=>{clearInterval(s)}},[e])},I=async(e,l)=>{var p;l.current=!0;const u=await async function(e,o={},i){const r={...k,...o};let c,m=r.initialDelay;for(let l=1;l<=r.maxAttempts;l++)try{return{success:!0,data:await e(),attempts:l}}catch(d){const e=t(d,a.UNKNOWN,s.MEDIUM,{...i,attempt:l});if(c=e,n.logErrorWithRetry(d,{...i,attempt:l},l-1),!(l<r.maxAttempts)||r.retryCondition&&!r.retryCondition(e))break;r.onRetry&&r.onRetry(l,e),l<r.maxAttempts&&(await T(m),m=Math.min(m*r.backoffMultiplier,r.maxDelay))}return{success:!1,error:c,attempts:r.maxAttempts}}(async()=>{const e=new AbortController,t=setTimeout(()=>e.abort(),o.DEFAULT_TIMEOUT_MS);try{const s=await fetch(d.SERVER_INFO,{signal:e.signal});if(clearTimeout(t),!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json(),n=JSON.stringify(a);if(n.includes("GDError")||n.includes("Couldn't query"))throw new Error("Game server query timeout - backend could not reach game server");return a}catch(s){throw clearTimeout(t),s}},{maxAttempts:3,initialDelay:2e3,retryCondition:e=>{var t;return e.type===a.NETWORK||e.type===a.SERVER&&500!==e.code||(null==(t=e.message)?void 0:t.includes("query timeout"))}},{component:"ServerInfoService",action:"fetch_server_info"});try{if(u.success&&u.data){const e=u.data;e.status=Object.keys(e).length>0?"1":"0",i.dispatch(r.setServerInfo(e))}else if(u.error){n.logError(u.error,{component:"ServerInfoService",action:"fetch_server_info",attempts:u.attempts},u.error.type,u.error.severity);if(null==(p=u.error.message)?void 0:p.includes("query timeout")){if(!e){const e={name:"Kether.pl",map:"–",players:"0",maxplayers:"0",bots:0,playerdetails:[],status:"0"};i.dispatch(r.setServerInfo(e))}}else{const e=c(u.error);m.ERROR(e);const t={name:"Kether.pl",map:"–",players:"0",maxplayers:"0",bots:0,playerdetails:[],status:"0"};i.dispatch(r.setServerInfo(t))}}}finally{l.current=!1}};const A=l(function(){const e=E(e=>e.serverInfoReducer.serverInfo),t=p();O();const s=S.useCallback(e=>{const t=~~(e/3600),s=~~(e%3600/60),a=~~e%60;let n="";return t>0&&(n+=t+":"+(s<10?"0":"")),n+=s+":"+(a<10?"0":""),n+=""+a,n},[]),a=S.useCallback(e=>u.jsx("span",{children:s(e.duration)}),[s]),n=S.useCallback(()=>{var s;return(null==(s=null==e?void 0:e.playerdetails)?void 0:s.length)?u.jsx("div",{className:"player-list-table",children:u.jsxs(y,{value:e.playerdetails,removableSort:!0,sortMode:"multiple",scrollable:!0,emptyMessage:t.noPlayersAvailable,children:[u.jsx(b,{field:"name",header:t.nickname,sortable:!0}),u.jsx(b,{field:"score",header:t.score,sortable:!0}),u.jsx(b,{body:a,header:t.duration})]})}):null},[e,a,t]);return u.jsxs("div",{className:"section future-rot",children:[u.jsxs("span",{children:[t.name,": ",null==e?void 0:e.name]}),u.jsxs("span",{children:["IP: ",h.IP,u.jsx(j,{icon:"pi pi-copy",style:{scale:"0.8",verticalAlign:"unset"},onClick:()=>{navigator.clipboard.writeText(h.IP),m.SUCCESS(f.COPY_SUCCESS)}})]}),u.jsxs("span",{children:[t.players,": ",null==e?void 0:e.players,"/",null==e?void 0:e.maxplayers," (",null==e?void 0:e.bots," ",1===(null==e?void 0:e.bots)?t.bot:t.bots,")"]}),u.jsxs("span",{children:[t.status,": ","1"===(null==e?void 0:e.status)?t.online:t.offline]}),u.jsxs("span",{children:[t.map,": ",null==e?void 0:e.map]}),u.jsx("span",{children:u.jsx(j,{label:t.joinGame,onClick:()=>{window.location.href=h.STEAM_CONNECT_URL}})}),n()&&u.jsx("span",{children:n()}),u.jsxs("span",{className:"centered-text",children:[t.customMapsText,u.jsx("a",{style:{display:"inline-block",marginLeft:"10px",textDecoration:"none",color:"white",WebkitTextStroke:" 3px red"},href:"https://steamcommunity.com/sharedfiles/filedetails/?id=2542824628",children:t.here})]})]})}),M={useCommandsLoadingService:()=>{$()},getCommands:()=>fetch(`${d.COMMANDS}/getCommands`,{method:"get"}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{i.dispatch(C.setCommands(e))}).catch(e=>{m.ERROR(`Error while fetching commands: ${e.message}`)}),addNewCommand:e=>fetch(`${d.COMMANDS}/addCommand`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:e.command,description:e.description})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>(M.getCommands(),e)).catch(e=>{throw m.ERROR(`Error while adding new command: ${e.message}`),e}),deleteCommand:e=>fetch(`${d.COMMANDS}/deleteCommand`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>(M.getCommands(),e.message)).catch(e=>{throw m.ERROR(`Error while deleting command: ${e.message}`),e}),updateCommand:e=>fetch(`${d.COMMANDS}/updateCommand`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id,command:e.command,description:e.description})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>(M.getCommands(),e.message)).catch(e=>{throw m.ERROR(`Error while updating command: ${e.message}`),e})},$=()=>{S.useEffect(()=>{M.getCommands()},[])};function V(e){return u.jsxs(u.Fragment,{children:[u.jsx("h5",{children:"Command"}),u.jsx(v,{value:e.command,onChange:t=>e.setCommand(t.target.value)}),u.jsx("h5",{children:"Description"}),u.jsx(v,{value:e.commandDescription,onChange:t=>e.setCommandDescription(t.target.value)})]})}function _(e){const t=g(),s=x();return u.jsx(R,{visible:e.isDialogVisible,header:t.editCommand,modal:!0,className:"p-fluid",footer:u.jsxs(u.Fragment,{children:[u.jsx(j,{label:s.cancel,icon:"pi pi-times",className:"p-button-text",onClick:()=>{e.commandEditingIdRef.current=-1,e.setDialogVisibility(!1)}}),u.jsx(j,{label:s.update,icon:"pi pi-check",className:"p-button-text",onClick:()=>{const t={command:e.command,description:e.commandDescription,id:e.commandEditingIdRef.current};M.updateCommand(t).then(()=>{m.SUCCESS("Successfully updated the command"),e.setDialogVisibility(!1),e.commandEditingIdRef.current=-1}).catch(e=>{m.ERROR(`Couldn't update the command: ${e.message}`)})}})]}),onHide:()=>{e.setDialogVisibility(!1)},children:u.jsx(V,{command:e.command,commandDescription:e.commandDescription,setCommand:e.setCommand,setCommandDescription:e.setCommandDescription})})}function P(e){const t=g(),s=x(),a=u.jsxs(u.Fragment,{children:[u.jsx(j,{label:s.cancel,icon:"pi pi-times",className:"p-button-text",onClick:()=>e.setDialogVisibility(!1)}),u.jsx(j,{label:s.save,icon:"pi pi-check",className:"p-button-text",onClick:()=>{const s={command:e.command,description:e.commandDescription};M.addNewCommand(s).then(()=>{m.SUCCESS(t.successfullyAdded),e.setDialogVisibility(!1),e.setCommandDescription("")}).catch(e=>{m.ERROR(`${t.couldntAdd}: ${e.message}`)})}})]});return u.jsx(R,{visible:e.isDialogVisible,header:t.addNewCommand,modal:!0,className:"p-fluid",footer:a,onHide:()=>e.setDialogVisibility(!1),children:u.jsx(V,{setCommandDescription:e.setCommandDescription,commandDescription:e.commandDescription,setCommand:e.setCommand,command:e.command})})}function U(){const e=E(e=>e.userDataReducer.isAdmin),t=E(e=>e.commandsReducer.commands),s=g(),[a,n]=S.useState(""),o=S.useRef(-1),[i,r]=S.useState(""),[c,d]=S.useState(!1),[l,p]=S.useState(!1);M.useCommandsLoadingService();return u.jsxs("div",{className:"section",children:[u.jsx(P,{setCommandDescription:n,commandDescription:a,setCommand:r,command:i,isDialogVisible:c,setDialogVisibility:d}),u.jsx(_,{setCommandDescription:n,commandDescription:a,setCommand:r,command:i,commandEditingIdRef:o,isDialogVisible:l,setDialogVisibility:p}),e&&u.jsx(D,{className:"mb-4",start:u.jsx(u.Fragment,{children:e&&u.jsx(j,{label:s.newCommand,icon:"pi pi-plus",className:"mr-2","data-toggle":"tooltip",title:s.addNewCommandTooltip,onClick:()=>d(!0)})})}),u.jsxs(y,{value:t,responsiveLayout:"scroll",style:{backgroundColor:"transparent",background:"transparent",backdropFilter:"blur(2px)"},emptyMessage:s.noCommandsAvailable,children:[u.jsx(b,{field:"command",header:s.command}),u.jsx(b,{field:"description",header:s.description}),e&&u.jsx(b,{header:s.actions,body:e=>u.jsxs(u.Fragment,{children:[u.jsx(j,{"data-toggle":"tooltip",title:s.editCommandTooltip,icon:"pi pi-pencil",className:"p-button-rounded mr-2",onClick:()=>{o.current=e.id,p(!0),r(e.command),n(e.description)}}),u.jsx(j,{"data-toggle":"tooltip",title:s.deleteCommandTooltip,icon:"pi pi-trash",className:"p-button-rounded p-button-danger",onClick:()=>{M.deleteCommand(e).then(e=>{m.SUCCESS(`${e}`),d(!1),n("")}).catch(e=>{m.ERROR(`${s.couldntDelete}: ${e}`)})}})]})})]})]})}function F(){return u.jsx(w,{imageUrl:N.BACKGROUND_1,children:u.jsxs("div",{className:"home-page",children:[u.jsx(A,{}),u.jsx(U,{})]})})}export{F as default};
