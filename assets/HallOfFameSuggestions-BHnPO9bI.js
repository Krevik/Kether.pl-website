import{r as e,t,n as s,b as i,v as n,x as o,l as a,j as d,m as r}from"./index-F7ZqYFXP.js";import{e as l,B as u,f as c,b as g,d as h}from"./primereact-a-ERR-hv.js";import{u as p}from"./redux-vendor-H9NaJiP7.js";import{D as b,t as S,b as m}from"./DialogBindContent-DNY1SjCi.js";import{a as x}from"./react-vendor-Cx5UeZsH.js";import{P as j,B}from"./backgrounds-FKC7tFuS.js";import"./i18n-DzW3M4iQ.js";const f={useBindSuggestionsLoadingService:()=>T(),getBindSuggestions:()=>fetch(`${e}${t.API_BASE_PATH}${t.BIND_SUGGESTIONS_PATH}/getBindSuggestions`,{method:"get"}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{i.dispatch(n.setBindSuggestions(e))}).catch(e=>{s.ERROR(`Error while fetching bind suggestions: ${e.message}`)}),addNewBindSuggestion:i=>fetch(`${e}${t.API_BASE_PATH}${t.BIND_SUGGESTIONS_PATH}/addBindSuggestion`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({author:i.author,text:i.text,proposed_by:i.proposed_by})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return f.getBindSuggestions(),e.json()}).catch(e=>{throw s.ERROR(`Error while adding new bind suggestion: ${e.message}`),e}),deleteBindSuggestion:i=>fetch(`${e}${t.API_BASE_PATH}${t.BIND_SUGGESTIONS_PATH}/deleteBindSuggestion`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:i.id})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>(f.getBindSuggestions(),e.message)).catch(e=>{throw s.ERROR(`Error while deleting bind suggestion: ${e.message}`),e})},T=()=>{const e=p(e=>e.userDataReducer.userData),[t,s]=x.useState(!0);return x.useEffect(()=>{s(!0),f.getBindSuggestions().finally(()=>{s(!1)})},[e]),t};function R(e){const t=p(e=>e.userDataReducer.userData),i=o(),n=a(),r=d.jsxs(d.Fragment,{children:[d.jsx(u,{label:n.cancel,icon:"pi pi-times",className:"p-button-text",onClick:()=>e.setDialogVisibility(!1)}),d.jsx(u,{label:n.save,icon:"pi pi-check",className:"p-button-text",onClick:()=>{const n={id:-1,proposed_by:t.personaname,author:e.bindAuthor,text:e.bindText};f.addNewBindSuggestion(n).then(()=>{s.SUCCESS(i.successfullySuggested),e.setDialogVisibility(!1),e.setBindText("")}).catch(e=>{s.ERROR(`${i.couldntAdd}: ${e}`)})}})]});return d.jsx(l,{visible:e.isDialogVisible,header:i.addNewSuggestion,modal:!0,className:"p-fluid",footer:r,onHide:()=>e.setDialogVisibility(!1),children:d.jsx(b,{setBindText:e.setBindText,bindText:e.bindText,setBindAuthor:e.setBindAuthor,bindAuthor:e.bindAuthor})})}const A=(e,t,s)=>d.jsx(d.Fragment,{children:e&&d.jsx(u,{label:s.suggestBind,icon:"pi pi-plus",className:"p-button-success mr-2","data-toggle":"tooltip",title:s.suggestBindTooltip,onClick:()=>t(!0)})});function N(){const e=p(e=>e.bindSuggestionsReducer.bindSuggestions),t=o(),i=r(),n=p(e=>e.userDataReducer.userID),a=p(e=>e.userDataReducer.userData),l=p(e=>e.userDataReducer.isAdmin),[b,T]=x.useState(!1),[N,E]=x.useState(""),$=x.useRef(-1),[D,y]=x.useState(""),_=f.useBindSuggestionsLoadingService();return d.jsx(j,{imageUrl:B.BACKGROUND_2,children:d.jsx("div",{className:"hall-of-fame-suggestions",children:d.jsxs("div",{className:"card",children:[d.jsx(R,{setBindText:y,bindText:D,setBindAuthor:E,bindAuthor:N,bindEditingIdRef:$,isDialogVisible:b,setDialogVisibility:T}),d.jsx(c,{className:"mb-4",start:A(n,T,t)}),d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"centered-text",children:t.bindSuggestions}),d.jsx("div",{className:"card",children:_?d.jsx("p",{children:"Loading..."}):d.jsxs(g,{value:(w=e,w.map(e=>({...e,author:`${e.author} : `}))),scrollable:!0,scrollHeight:"flex",emptyMessage:t.noSuggestionsAvailable,children:[l&&d.jsx(h,{field:"id",header:i.databaseId,sortable:!0}),d.jsx(h,{field:"proposed_by",header:t.proposedBy}),d.jsx(h,{field:"author",header:i.author,sortable:!0}),d.jsx(h,{field:"text",header:i.text,sortable:!0}),l&&d.jsx(h,{header:i.actions,body:e=>((e,t,i,n)=>t&&d.jsxs(d.Fragment,{children:[d.jsx(u,{"data-toggle":"tooltip",title:n.acceptBindTooltip,icon:"pi pi-check",className:"p-button-rounded p-button-success",onClick:()=>{const t=S(e);m.addNewBind(t,null==i?void 0:i.steamid).then(e=>{s.SUCCESS(n.successfullyAccepted),f.deleteBindSuggestion(t)}).catch(e=>{s.ERROR(`${n.couldntAccept}: ${e}`)})}}),d.jsx(u,{"data-toggle":"tooltip",title:n.deleteSuggestionTooltip,icon:"pi pi-times",className:"p-button-rounded p-button-danger",onClick:()=>{f.deleteBindSuggestion(e).then(e=>{s.SUCCESS(`Successfully deleted bind suggestion: ${e}`)}).catch(e=>{s.ERROR(`${n.couldntDelete}: ${e}`)})}})]}))(e,l,a,t)})]})})]})]})})});var w}export{N as default};
