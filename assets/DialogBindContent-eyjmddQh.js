import{a as T}from"./react-vendor-D_ZCUrOg.js";import{r as s,t as n,n as d,b as O,y as $,j as i}from"./index-Cjl1f2S7.js";import{u as v}from"./redux-vendor-CyXvn3Yl.js";import{I as m}from"./primereact-PWt0ZiM-.js";var c=(t=>(t.UPVOTE="Upvote",t.DOWNVOTE="Downvote",t))(c||{});const u={useBindsLoadingService:t=>I(t||void 0),getBinds:t=>fetch(`${s}${n.API_BASE_PATH}${n.BINDS_PATH}/getBinds`,{method:"get"}).then(r=>{if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return r.json()}).then(r=>{const e=r.map(o=>{var l,g,A,E;const a=((l=o.upvote)==null?void 0:l.length)||0,f=((g=o.downvote)==null?void 0:g.length)||0;let h;if(t){const p=Number(t);(A=o.upvote)!=null&&A.includes(p)?h=c.UPVOTE:(E=o.downvote)!=null&&E.includes(p)&&(h=c.DOWNVOTE)}return{id:o.id,author:o.author,text:o.text,votingData:{id:o.id,attachedBindID:o.id,Upvotes:a,Downvotes:f,selfVote:h}}});O.dispatch($.setBinds(e))}).catch(r=>{d.ERROR(`Error while fetching binds: ${r.message}`)}),setVote:(t,r)=>{const e={voter_steam_id:Number(t.voterSteamID),voted_bind_id:Number(t.votedBindID),vote:t.vote};return fetch(`${s}${n.API_BASE_PATH}${n.BIND_VOTES_PATH}/${r?"deleteBindVoting":"addBindVoting"}`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(o=>{if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return u.getBinds(t.voterSteamID),o.text()}).catch(o=>{throw d.ERROR(`Error while setting vote: ${o.message}`),o})},addNewBind:(t,r)=>fetch(`${s}${n.API_BASE_PATH}${n.BINDS_PATH}/addBind`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({author:t.author,text:t.text})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return u.getBinds(r),e.json()}).catch(e=>{throw d.ERROR(`Error while adding new bind: ${e.message}`),e}),deleteBind:(t,r)=>fetch(`${s}${n.API_BASE_PATH}${n.BINDS_PATH}/deleteBind`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.id})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>(u.getBinds(r),e.message)).catch(e=>{throw d.ERROR(`Error while deleting bind: ${e.message}`),e}),updateBind:(t,r)=>fetch(`${s}${n.API_BASE_PATH}${n.BINDS_PATH}/updateBind`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.id,author:`${t.author}`,text:`${t.text}`})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>(u.getBinds(r),e.message)).catch(e=>{throw d.ERROR(`Error while updating bind: ${e.message}`),e})},I=t=>{const r=v(a=>a.userDataReducer.userData),[e,o]=T.useState(!0);return T.useEffect(()=>{o(!0),u.getBinds(t).finally(()=>{o(!1)})},[r,t]),e},S=t=>({...t,author:t.author.replace(":","").trim()}),B={replaceNonEnglishLatinChars:t=>{const r={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",Ç:"C",È:"E",É:"E",Ê:"E",Ë:"E",Ì:"I",Í:"I",Î:"I",Ï:"I",Ñ:"N",Ò:"O",Ô:"O",Õ:"O",Ö:"O",O̧:"O",Ù:"U",Ú:"U",Û:"U",Ü:"U",Ý:"Y",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",ç:"c",è:"e",é:"e",ê:"e",ë:"e",ì:"i",í:"i",î:"i",ï:"i",ñ:"n",ò:"o",ô:"o",õ:"o",ö:"o",o̧:"o",ù:"u",ú:"u",û:"u",ü:"u",ý:"y",Ą:"A",Ć:"C",Ę:"E",Ł:"L",Ń:"N",Ó:"O",Ś:"S",Ź:"Z",Ż:"Z",ą:"a",ć:"c",ę:"e",ł:"l",ń:"n",ó:"o",ś:"s",ź:"z",ż:"z"};return t.normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^\u0000-\u007F]/g,a=>r[a]||a).replace(/[:;#*()]/g,"").replace("^","").replace("%"," procent")}};function _(t){return i.jsxs(i.Fragment,{children:[i.jsx("h5",{children:"Author"}),i.jsx(m,{value:B.replaceNonEnglishLatinChars(t.bindAuthor),onChange:r=>t.setBindAuthor(r.target.value)}),i.jsx("h5",{children:"Text"}),i.jsx(m,{value:B.replaceNonEnglishLatinChars(t.bindText),onChange:r=>t.setBindText(r.target.value)})]})}export{c as B,_ as D,u as b,S as t};
