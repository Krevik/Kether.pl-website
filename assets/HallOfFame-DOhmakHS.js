import{m as v,l as S,j as i,n as u}from"./index-Cjl1f2S7.js";import{e as C,B as c,f as A,b as E,d as h}from"./primereact-PWt0ZiM-.js";import{u as f}from"./redux-vendor-CyXvn3Yl.js";import{D as y,b as B,t as p,B as b}from"./DialogBindContent-eyjmddQh.js";import{a as x}from"./react-vendor-D_ZCUrOg.js";import{P as O,B as U}from"./backgrounds-DqLVt_KU.js";import"./i18n-5_3iJCmZ.js";function k(t){const e=v(),n=S(),s=()=>i.jsxs(i.Fragment,{children:[i.jsx(c,{label:n.cancel,icon:"pi pi-times",className:"p-button-text",onClick:()=>{t.bindEditingIdRef.current=-1,t.setDialogVisibility(!1)}}),i.jsx(c,{label:n.update,icon:"pi pi-check",className:"p-button-text",onClick:()=>{const d={author:t.bindAuthor,text:t.bindText,id:t.bindEditingIdRef.current};B.updateBind(d).then(()=>{u.SUCCESS("Successfully updated the bind"),t.setDialogVisibility(!1),t.bindEditingIdRef.current=-1}).catch(o=>{u.ERROR(`Couldn't update the bind: ${o}`)})}})]});return i.jsx(C,{visible:t.isDialogVisible,header:e.editBind,modal:!0,className:"p-fluid",footer:s(),onHide:()=>{t.setDialogVisibility(!1)},children:i.jsx(y,{bindAuthor:t.bindAuthor,bindText:t.bindText,setBindAuthor:t.setBindAuthor,setBindText:t.setBindText})})}function I(t){const e=v(),n=S(),s=i.jsxs(i.Fragment,{children:[i.jsx(c,{label:n.cancel,icon:"pi pi-times",className:"p-button-text",onClick:()=>t.setDialogVisibility(!1)}),i.jsx(c,{label:n.save,icon:"pi pi-check",className:"p-button-text",onClick:()=>{const d={author:t.bindAuthor,text:t.bindText};B.addNewBind(d).then(()=>{u.SUCCESS(e.successfullyAdded),t.setDialogVisibility(!1),t.setBindText("")}).catch(o=>{u.ERROR(`${e.couldntAdd}: ${o}`)})}})]});return i.jsx(C,{visible:t.isDialogVisible,header:e.addNewBind,modal:!0,className:"p-fluid",footer:s,onHide:()=>t.setDialogVisibility(!1),children:i.jsx(y,{setBindText:t.setBindText,bindText:t.bindText,setBindAuthor:t.setBindAuthor,bindAuthor:t.bindAuthor})})}const $=t=>t.map(e=>({...e,author:`${e.author} : `})),w=(t,e,n)=>i.jsx(i.Fragment,{children:t&&i.jsx(c,{label:n.newBind,icon:"pi pi-plus",className:"p-button-success mr-2","data-toggle":"tooltip",title:n.addNewBindTooltip,onClick:()=>e(!0)})}),F=(t,e,n,s,d,o,a)=>i.jsxs(i.Fragment,{children:[i.jsx(c,{"data-toggle":"tooltip",title:a.editBindTooltip,icon:"pi pi-pencil",className:"p-button-rounded p-button-warning mr-2",onClick:()=>{d.current=t.id,e(!0),n(p(t).author),s(t.text)}}),i.jsx(c,{"data-toggle":"tooltip",title:a.deleteBindTooltip,icon:"pi pi-trash",className:"p-button-rounded p-button-danger",onClick:()=>{B.deleteBind(t,o==null?void 0:o.steamid).then(r=>{u.SUCCESS(`${r}`)}).catch(r=>{u.ERROR(`${a.couldntDelete}: ${r}`)})}})]}),N=(t,e,n,s)=>{var o;const d={voterSteamID:n==null?void 0:n.steamid,votedBindID:e.id.toString(),vote:t};d.id=((o=e.votingData)==null?void 0:o.id)||void 0,B.setVote(d,s).then(a=>{u.SUCCESS(a)}).catch(a=>{u.ERROR(a)})},P=(t,e)=>{var r,m,g;const n=(r=t.votingData)==null?void 0:r.selfVote,s=n&&n===b.UPVOTE?"self-voted":"",d=n&&n===b.DOWNVOTE?"self-voted":"",o=`vote-up-button ${s}`,a=`vote-down-button ${d}`;return i.jsxs(i.Fragment,{children:[i.jsx(c,{className:o,icon:"pi pi-thumbs-up",onClick:()=>{N(b.UPVOTE,t,e,n&&n===b.UPVOTE)},children:((m=t.votingData)==null?void 0:m.Upvotes)||0}),i.jsx(c,{className:a,icon:"pi pi-thumbs-down",onClick:()=>{N(b.DOWNVOTE,t,e,n&&n===b.DOWNVOTE)},children:((g=t.votingData)==null?void 0:g.Downvotes)||0})]})};function q(){const t=f(l=>l.bindsReducer.binds),e=v(),n=f(l=>l.userDataReducer.isAdmin),s=f(l=>l.userDataReducer.userData),d=f(l=>l.userDataReducer.userID),[o,a]=x.useState(!1),[r,m]=x.useState(!1),[g,j]=x.useState(""),D=x.useRef(-1),[V,T]=x.useState(""),R=B.useBindsLoadingService(s==null?void 0:s.steamid);return i.jsx(O,{imageUrl:U.BACKGROUND_2,children:i.jsx("div",{className:"hall-of-fame",children:i.jsxs("div",{className:"card",children:[i.jsx(I,{setBindText:T,bindText:V,setBindAuthor:j,bindAuthor:g,isDialogVisible:o,setDialogVisibility:a}),i.jsx(k,{setBindText:T,bindText:V,setBindAuthor:j,bindAuthor:g,bindEditingIdRef:D,isDialogVisible:r,setDialogVisibility:m}),i.jsx(A,{className:"mb-4",start:w(n,a,e)}),i.jsx("div",{className:"centered-text",children:e.binds}),i.jsx("div",{className:"card",children:R?i.jsx("p",{children:"Loading..."}):i.jsxs(E,{value:$(t),scrollable:!0,scrollHeight:"flex",emptyMessage:e.noBindsAvailable,children:[n&&i.jsx(h,{field:"id",header:e.databaseId,sortable:!0}),i.jsx(h,{field:"author",header:e.author,sortable:!0}),i.jsx(h,{field:"text",header:e.text,sortable:!0}),d&&s&&s.steamid&&i.jsx(h,{className:"voting",header:e.voting,body:l=>P(l,s)}),n&&i.jsx(h,{header:e.actions,body:l=>F(l,m,j,T,D,s,e)})]})})]})})})}export{q as default};
