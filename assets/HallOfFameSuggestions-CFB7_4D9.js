import{x as e,y as t,n as s,b as i,z as a,B as o,m as n,j as d,o as r}from"./index-PUGTdxub.js";import{e as l,B as u,f as g,b as c,d as p}from"./primereact-C2ngy8op.js";import{u as h}from"./redux-vendor-y6Da-rhS.js";import{D as b,t as S,b as m}from"./DialogBindContent-DiYjcHqK.js";import{a as x}from"./react-vendor-CFOk4vZh.js";import{P as f,B as j}from"./backgrounds-cpbz9wIW.js";import"./i18n-X45JNxKt.js";const B={useBindSuggestionsLoadingService:()=>T(),getBindSuggestions:()=>fetch(`${e}${t.API_BASE_PATH}${t.BIND_SUGGESTIONS_PATH}/getBindSuggestions`,{method:"get"}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{i.dispatch(a.setBindSuggestions(e))}).catch(e=>{s.ERROR(`Error while fetching bind suggestions: ${e.message}`)}),addNewBindSuggestion:i=>fetch(`${e}${t.API_BASE_PATH}${t.BIND_SUGGESTIONS_PATH}/addBindSuggestion`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({author:i.author,text:i.text,proposed_by:i.proposed_by})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return B.getBindSuggestions(),e.json()}).catch(e=>{throw s.ERROR(`Error while adding new bind suggestion: ${e.message}`),e}),deleteBindSuggestion:i=>fetch(`${e}${t.API_BASE_PATH}${t.BIND_SUGGESTIONS_PATH}/deleteBindSuggestion`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:i.id})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>(B.getBindSuggestions(),e.message)).catch(e=>{throw s.ERROR(`Error while deleting bind suggestion: ${e.message}`),e})},T=()=>{const e=h(e=>e.userDataReducer.userData),[t,s]=x.useState(!0);return x.useEffect(()=>{s(!0),B.getBindSuggestions().finally(()=>{s(!1)})},[e]),t};function R(e){const t=h(e=>e.userDataReducer.userData),i=o(),a=n(),r=d.jsxs(d.Fragment,{children:[d.jsx(u,{label:`❌ ${a.cancel}`,className:"p-button-text app-focus-ring",onClick:()=>e.setDialogVisibility(!1)}),d.jsx(u,{label:`✅ ${a.save}`,className:"p-button-text app-focus-ring",onClick:()=>{const a={id:-1,proposed_by:t.personaname,author:e.bindAuthor,text:e.bindText};B.addNewBindSuggestion(a).then(()=>{s.SUCCESS(i.successfullySuggested),e.setDialogVisibility(!1),e.setBindText("")}).catch(e=>{s.ERROR(`${i.couldntAdd}: ${e}`)})}})]});return d.jsx(l,{visible:e.isDialogVisible,header:i.addNewSuggestion,modal:!0,className:"p-fluid app-dialog",footer:r,onHide:()=>e.setDialogVisibility(!1),children:d.jsx(b,{setBindText:e.setBindText,bindText:e.bindText,setBindAuthor:e.setBindAuthor,bindAuthor:e.bindAuthor})})}const $=(e,t,s)=>d.jsx(d.Fragment,{children:e&&d.jsx(u,{label:`➕ ${s.suggestBind}`,className:"p-button-success mr-2 app-focus-ring","data-toggle":"tooltip",title:s.suggestBindTooltip,onClick:()=>t(!0)})});function A(){const e=h(e=>e.bindSuggestionsReducer.bindSuggestions),t=o(),i=r(),a=h(e=>e.userDataReducer.userID),n=h(e=>e.userDataReducer.userData),l=h(e=>e.userDataReducer.isAdmin),[b,T]=x.useState(!1),[A,N]=x.useState(""),E=x.useRef(-1),[y,D]=x.useState(""),_=B.useBindSuggestionsLoadingService();return d.jsx(f,{imageUrl:j.BACKGROUND_2,children:d.jsx("div",{className:"hall-of-fame-suggestions",children:d.jsxs("div",{className:"card app-surface app-page-card",children:[d.jsx(R,{setBindText:D,bindText:y,setBindAuthor:N,bindAuthor:A,bindEditingIdRef:E,isDialogVisible:b,setDialogVisibility:T}),d.jsx(g,{className:"mb-4 app-toolbar",start:$(a,T,t)}),d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"centered-text",children:t.bindSuggestions}),d.jsx("div",{className:"card",children:_?d.jsx("p",{children:"Loading..."}):d.jsxs(c,{value:(w=e,w.map(e=>({...e,author:`${e.author} : `}))),className:"app-data-table",scrollable:!0,scrollHeight:"flex",emptyMessage:t.noSuggestionsAvailable,children:[l&&d.jsx(p,{field:"id",header:i.databaseId,sortable:!0}),d.jsx(p,{field:"proposed_by",header:t.proposedBy}),d.jsx(p,{field:"author",header:i.author,sortable:!0}),d.jsx(p,{field:"text",header:i.text,sortable:!0}),l&&d.jsx(p,{header:i.actions,body:e=>((e,t,i,a)=>t&&d.jsxs(d.Fragment,{children:[d.jsx(u,{"data-toggle":"tooltip",title:a.acceptBindTooltip,label:"✅",className:"p-button-rounded p-button-success app-focus-ring",onClick:()=>{const t=S(e);m.addNewBind(t,null==i?void 0:i.steamid).then(e=>{s.SUCCESS(a.successfullyAccepted),B.deleteBindSuggestion(t)}).catch(e=>{s.ERROR(`${a.couldntAccept}: ${e}`)})}}),d.jsx(u,{"data-toggle":"tooltip",title:a.deleteSuggestionTooltip,label:"❌",className:"p-button-rounded p-button-danger app-focus-ring",onClick:()=>{B.deleteBindSuggestion(e).then(e=>{s.SUCCESS(`Successfully deleted bind suggestion: ${e}`)}).catch(e=>{s.ERROR(`${a.couldntDelete}: ${e}`)})}})]}))(e,l,n,t)})]})})]})]})})});var w}export{A as default};
